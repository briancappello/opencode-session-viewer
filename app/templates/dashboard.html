<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenCode Sessions</title>
    <link rel="stylesheet" href="/static/css/base.css" />
    <link rel="stylesheet" href="/static/css/dashboard.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="title">OpenCode Sessions</div>
        <div class="controls">
          <a href="/archived" class="toggle-btn" title="View archived sessions"
            >Archived</a
          >
          <a
            href="/?all={{ 'false' if show_all else 'true' }}"
            class="toggle-btn {{ 'active' if show_all }}"
          >
            {{ 'Hide Subagents' if show_all else 'Show All' }}
          </a>
          <button
            class="theme-toggle"
            onclick="toggleTheme()"
            title="Toggle dark mode"
          >
            ðŸŒ“
          </button>
        </div>
      </div>

      <div class="search-container">
        <input
          type="text"
          id="searchInput"
          class="search-input"
          placeholder="Search session contents..."
        />
        <select id="directorySelect" class="directory-select">
          <option value="">All directories</option>
        </select>
        <button onclick="performSearch()" class="search-btn" id="searchBtn">
          Search
        </button>
        <button onclick="syncIndex()" class="sync-btn" id="syncBtn">
          Sync
        </button>
        <button onclick="clearSearch()" class="clear-btn hidden" id="clearBtn">
          Clear
        </button>
      </div>
      <div class="search-options">
        <label class="checkbox-label">
          <input type="checkbox" id="regexCheckbox" />
          <span>Use regular expression</span>
        </label>
      </div>

      <div id="searchResultsHeader" class="search-results-header hidden">
        <span id="searchResultsCount"></span>
      </div>

      <div class="session-list" id="sessionList">
        {% for session in sessions %}
          <div class="session-item" data-session-id="{{ session.id }}">
            <a href="/session/{{ session.id }}" class="session-item-link">
              <div class="session-header">
                <div class="session-title">
                  {{ session.title or "Untitled" }}
                </div>
                <div class="session-time">{{ session.updated_formatted }}</div>
              </div>
              <div class="session-meta">
                <div class="meta-item">
                  <span>ðŸ“‚</span>
                  <span class="directory" title="{{ session.directory }}"
                    >{{ session.directory_short }}</span
                  >
                </div>
                {% if session.model %}
                  <div class="meta-item">
                    <span>ðŸ¤–</span>
                    <span>{{ session.model }}</span>
                  </div>
                {% endif %}
                <div class="meta-item">
                  <span style="color: var(--text-tertiary)"
                    >ID: {{ session.id }}</span
                  >
                </div>
              </div>
            </a>
            <a
              href="#"
              class="archive-link"
              onclick="archiveSession('{{ session.id }}', event)"
              >Archive</a
            >
          </div>
        {% else %}
          <div class="empty-state">No sessions found.</div>
        {% endfor %}
      </div>
    </div>

    <script src="/static/js/base.js"></script>
    <script src="/static/js/dashboard.js"></script>
  </body>
</html>
