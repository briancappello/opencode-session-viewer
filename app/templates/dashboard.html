<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenCode Conversations</title>
    <link rel="stylesheet" href="/static/css/base.css" />
    <link rel="stylesheet" href="/static/css/dashboard.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="title">OpenCode Conversations</div>
        <div class="controls">
          <a
            href="/archived"
            class="toggle-btn"
            title="View archived conversations"
            >Archived</a
          >
          <a
            href="/?all={{ 'false' if show_all else 'true' }}"
            class="toggle-btn {{ 'active' if show_all }}"
          >
            {{ 'Hide Subagents' if show_all else 'Show All' }}
          </a>
          <button
            class="theme-toggle"
            onclick="toggleTheme()"
            title="Toggle dark mode"
          >
            ðŸŒ“
          </button>
        </div>
      </div>

      <div class="search-container">
        <input
          type="text"
          id="searchInput"
          class="search-input"
          placeholder="Search conversation contents..."
        />
        <select id="directorySelect" class="directory-select">
          <option value="">All directories</option>
        </select>
        <button onclick="performSearch()" class="search-btn" id="searchBtn">
          Search
        </button>
        <button onclick="syncIndex()" class="sync-btn" id="syncBtn">
          Sync
        </button>
        <button onclick="clearSearch()" class="clear-btn hidden" id="clearBtn">
          Clear
        </button>
      </div>
      <div class="search-options">
        <label class="checkbox-label">
          <input type="checkbox" id="regexCheckbox" />
          <span>Use regular expression</span>
        </label>
      </div>

      <div id="searchResultsHeader" class="search-results-header hidden">
        <span id="searchResultsCount"></span>
      </div>

      <div class="conversation-list" id="conversationList">
        {% for conversation in conversations %}
          <div
            class="conversation-item"
            data-conversation-id="{{ conversation.id }}"
          >
            <a
              href="/conversation/{{ conversation.id }}"
              class="conversation-item-link"
            >
              <div class="conversation-header">
                <div class="conversation-title">
                  {{ conversation.title or "Untitled" }}
                </div>
                <div class="conversation-time">
                  {{ conversation.updated_formatted }}
                </div>
              </div>
              <div class="conversation-meta">
                <div class="meta-item">
                  <span>ðŸ“‚</span>
                  <span class="directory" title="{{ conversation.directory }}"
                    >{{ conversation.directory_short }}</span
                  >
                </div>
                {% if conversation.model %}
                  <div class="meta-item">
                    <span>ðŸ¤–</span>
                    <span>{{ conversation.model }}</span>
                  </div>
                {% endif %}
                <div
                  class="meta-item conversation-id-copy"
                  data-conversation-id="{{ conversation.id }}"
                  onclick="copyConversationCommand(this, event)"
                  title="Click to copy opencode command"
                >
                  <span style="color: var(--text-tertiary)"
                    >ID: {{ conversation.id }}</span
                  >
                </div>
              </div>
            </a>
            <a
              href="#"
              class="archive-link"
              onclick="archiveConversation('{{ conversation.id }}', event)"
              >Archive</a
            >
          </div>
        {% else %}
          <div class="empty-state">No conversations found.</div>
        {% endfor %}
      </div>
    </div>

    <script src="/static/js/base.js"></script>
    <script src="/static/js/dashboard.js"></script>
  </body>
</html>
